# SPEC-PUB-TRANSLATE-001: 영어 PDF → 한국어 완성원고 번역 및 편집

**Version**: 1.0.0
**Status**: DRAFT
**Priority**: HIGH
**Phase**: Phase 1 (핵심 파이프라인)
**Created**: 2025-11-16
**Updated**: 2025-11-16
**Language**: 한국어
**Owner**: @user

---

## 📋 규격 요약

영어로 된 PDF 원서를 입력받아 고품질 한국어 완성원고를 마크다운 파일로 생성하는 자동화된 번역 및 편집 파이프라인을 구축합니다. 당장 출판이 가능한 수준의 완성원고를 목표로 합니다.

**핵심 처리 단계**:
1. PDF 텍스트 추출 및 구조 분석
2. 청킹 (처리 가능한 단위로 분할)
3. 번역 (병렬 처리)
4. 편집 (교정교열 + 윤문)
5. 스타일 가이드 적용
6. 최종 검수 및 통합

---

## 🎯 필수 요구사항 (UBIQUITOUS)

> 시스템은 당장 출판이 가능한 수준의 한국어 원고 마크다운을 생성해야 함
> 시스템은 번역 과정의 모든 단계를 추적 가능해야 함
> 시스템은 청크 기반 병렬 처리를 통해 대용량 원고 처리 가능해야 함
> 시스템은 한국 출판 시장의 용어 규범을 준수해야 함
> 시스템은 각 청크의 품질 지표를 기록해야 함

---

## 📁 이벤트 기반 요구사항 (EVENT-DRIVEN)

### WHEN 사용자가 영어 PDF 원서를 업로드할 때

```
GIVEN: 스캔본이 아닌 텍스트 기반 PDF 파일 (OCR 불필요)
WHEN: 사용자가 PDF 파일과 기본 메타데이터(제목, 저자, 출판 정보)를 업로드
THEN: 시스템은 다음을 수행해야 함
  ✅ PDF에서 텍스트 추출 및 구조 분석 (챕터/절/단락 자동 감지)
  ✅ 원본 구조 정보를 메타데이터로 저장
  ✅ 추출된 텍스트와 구조를 확인하는 프리뷰 제공
  ✅ 사용자 확인 후 다음 단계로 진행
```

### WHEN 사용자가 번역 설정을 확인할 때

```
GIVEN: 추출된 원문과 구조 정보
WHEN: 사용자가 번역 설정 페이지 접근 (출판 영역, 대상 독자, 용어 선호도 등)
THEN: 시스템은 다음을 수행해야 함
  ✅ [moai-pub-style-guide] 스킬에서 맞춤형 용어집 로드
  ✅ 번역 청크 크기 설정 (기본값: 50KB, 약 10,000단어)
  ✅ 병렬 처리 수준 설정 (최대 5개 동시 처리)
  ✅ 최종 검수 강도 설정 (표준/엄격)
```

### WHEN 번역 작업이 시작될 때

```
GIVEN: 설정 완료된 원고 + 스타일 가이드
WHEN: 사용자가 "번역 시작" 버튼 클릭
THEN: 시스템은 다음을 수행해야 함
  ✅ [moai-pub-chunking] 스킬로 청크 생성 (메타데이터 포함: 청크ID, 원본위치, 문맥)
  ✅ [moai-pub-translator] 에이전트를 병렬로 호출 (최대 5개 청크 동시 처리)
  ✅ 각 청크별 번역 진행 상황 실시간 추적
  ✅ 번역 완료된 청크를 임시 저장소에 저장
```

### WHEN 각 청크 번역이 완료될 때

```
GIVEN: 번역된 청크들 (일부는 미완료)
WHEN: 청크별 번역 완료
THEN: 시스템은 다음을 수행해야 함
  ✅ [moai-pub-editor] 에이전트로 교정교열 수행
  ✅ [moai-pub-style-guide] 규칙 자동 적용 (용어 통일, 띄어쓰기, 문체)
  ✅ 편집된 버전 저장 및 버전 관리
  ✅ 품질 지표 기록 (가독성 점수, 일관성 점수)
```

### WHEN 모든 청크 처리가 완료될 때

```
GIVEN: 편집 완료된 모든 청크
WHEN: 마지막 청크 처리 완료
THEN: 시스템은 다음을 수행해야 함
  ✅ [moai-pub-orchestrator] 에이전트로 청크 통합 (원본 순서 복원)
  ✅ 장절 제목, 인용문, 목록 등 특수 요소 포맷 복원
  ✅ 전체 원고 일관성 검수 (용어, 문체, 톤앤매너)
  ✅ 최종 마크다운 파일 생성
```

### WHEN 사용자가 최종 검수를 요청할 때

```
GIVEN: 통합된 완성원고 마크다운
WHEN: 사용자가 "최종 검수" 버튼 클릭
THEN: 시스템은 다음을 수행해야 함
  ✅ 자동 검수 항목 실행 (오타, 일관성, 포맷)
  ✅ 발견된 문제점 목록 제시
  ✅ 사용자의 수동 검수 제안
  ✅ 승인 시 최종 파일 확정 + git 커밋
```

---

## 🚫 원하지 않는 동작 (UNWANTED BEHAVIOR)

### IF 청크별 번역 품질이 기준 미달일 때

```
THEN: 시스템은 다음을 수행해야 함
  ✅ 문제 청크 식별 및 플래그 표시
  ✅ 해당 청크만 재번역 제안
  ✅ 사용자에게 수정 옵션 제시
  ✅ 재번역 과정 기록
```

### IF 번역 과정에서 용어 불일치가 발생할 때

```
THEN: 시스템은 다음을 수행해야 함
  ✅ 불일치 항목 자동 감지
  ✅ [moai-pub-style-guide]의 규정 용어로 자동 통일
  ✅ 변경 내역 기록 (감사 추적)
  ✅ 사용자에게 변경 사항 알림
```

### IF 특수 요소 (표, 이미지 참조, 수식)가 포함되어 있을 때

```
THEN: 시스템은 다음을 수행해야 함
  ✅ 특수 요소 자동 감지 및 플래그
  ✅ 마크다운 호환 포맷으로 변환 (테이블, 이미지 링크 등)
  ✅ 불가능한 요소는 대체 텍스트 제공
  ✅ 사용자에게 수정 필요 사항 안내
```

### IF 번역 과정 중 오류가 발생할 때

```
THEN: 시스템은 다음을 수행해야 함
  ✅ 오류 명확히 기록 (오류 코드, 청크ID, 타임스탬프)
  ✅ 사용자에게 구체적인 오류 메시지 제시
  ✅ 해당 청크 재처리 옵션 제공
  ✅ 전체 작업 진행 상황 저장 (복구 가능하게)
```

---

## ⚙️ 상태 기반 요구사항 (STATE-DRIVEN)

### WHILE 번역 작업 진행 중

```
시스템은 다음을 유지해야 함:
  ✅ 청크별 처리 상태 표시 (대기중/처리중/완료/오류)
  ✅ 전체 진행률 계산 및 표시
  ✅ 예상 소요 시간 업데이트
  ✅ 중단 및 재개 기능 제공
  ✅ 작업 로그 실시간 스트리밍
```

### WHILE 품질 검수 진행 중

```
시스템은 다음을 유지해야 함:
  ✅ 검수 항목별 상태 추적
  ✅ 지적된 문제점 임시 저장
  ✅ 수정 전/후 버전 비교 기능
  ✅ 검수 의견 기록
```

---

## 🎁 선택 기능 (OPTIONAL)

### WHERE 사용자가 고급 번역 옵션을 원할 때

```
시스템은 다음을 제공해야 함:
  ✅ 번역 스타일 선택 (직역/의역, 문어/구어 레벨)
  ✅ 용어 커스터마이징 (특정 용어에 대한 선호 번역)
  ✅ 참고 자료 첨부 (관련 도서, 용어 해설)
  ✅ 번역자 노트 추가 기능
```

### WHERE 사용자가 다국어 지원을 요청할 때

```
시스템은 확장해야 함:
  ✅ 영어 외 다른 언어 지원 준비 (중국어, 일본어, 스페인어 등)
  ✅ 언어별 스타일 가이드 관리
  ✅ 언어별 QA 규칙 정의
```

---

## ✅ 수용 기준 (ACCEPTANCE CRITERIA)

### Given/When/Then 시나리오 1: 기본 번역 흐름

```
Given: 200페이지(약 80,000단어) 영어 학술서 PDF
When: 전체 번역 파이프라인 실행
Then:
  ✅ 5-6시간 내 완료 (병렬 처리)
  ✅ 번역 품질: 가독성 점수 ≥85점
  ✅ 일관성: 용어 통일도 ≥95%
  ✅ 최종 마크다운: 원본 구조 100% 유지
  ✅ 특수 포맷 (표, 리스트): 100% 복원
```

### Given/When/Then 시나리오 2: 청크 단위 재처리

```
Given: 번역 완료된 원고 중 3개 청크 품질 미달
When: 사용자가 해당 청크 재번역 요청
Then:
  ✅ 해당 청크만 재처리 (3-5분)
  ✅ 나머지 청크 영향 없음
  ✅ 재번역된 청크 자동 통합
  ✅ 전체 원고 일관성 재검수
```

### Given/When/Then 시나리오 3: 스타일 가이드 적용

```
Given: 번역 완료된 원고 + 맞춤 스타일 가이드
When: 스타일 가이드 규칙 자동 적용
Then:
  ✅ 출판사 용어집의 용어 100% 통일
  ✅ 띄어쓰기 규칙 적용
  ✅ 문체 일관성 검증
  ✅ 변경 사항 감사 추적 가능
```

### Given/When/Then 시나리오 4: 오류 복구

```
Given: 처리 중 일부 청크 오류 발생
When: 시스템이 오류 감지
Then:
  ✅ 즉시 중단 (이미 완료된 청크 보존)
  ✅ 오류 원인 명확히 기록
  ✅ 사용자에게 구체적인 재시작 옵션 제시
  ✅ 이전 진행 상황 복구 가능
```

---

## 📊 기술 스택 및 의존성

**필수 에이전트**:
- `moai-pub-translator`: 번역 담당
- `moai-pub-editor`: 교정 및 편집
- `moai-pub-orchestrator`: 청크 관리 및 통합

**필수 스킬**:
- `moai-pub-chunking`: 텍스트 분할
- `moai-pub-style-guide`: 출판 규범 관리

**외부 의존성**:
- PyPDF2 또는 pdfplumber (PDF 텍스트 추출)
- Claude API (번역 & 편집)
- Context7 MCP (참고 자료 검색)

**버전 요구사항**:
- Python ≥3.11
- Claude Sonnet 4.5+ (번역/편집 작업)
- Claude Haiku 4.5 (병렬 품질 검사)

---

## 📈 성공 지표

- **처리 속도**: 50KB당 3-5분 (병렬 처리 5개)
- **번역 품질**: 가독성 점수 ≥85점
- **일관성**: 용어 통일도 ≥95%
- **오류율**: <0.5%
- **사용자 만족도**: ≥4/5별

---

## 🔄 의존성

- SPEC-007 (오케스트레이션): 청크 관리 기반 필요
- SPEC-004 (편집 파이프라인): 편집 로직 재사용

---

## 다음 단계

1. 각 에이전트의 상세 구현 설계
2. 청크 크기 및 병렬도 최적화 실험
3. 스타일 가이드 데이터 구축
4. 품질 검수 기준 정의 및 자동화
