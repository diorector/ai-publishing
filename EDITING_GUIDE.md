# 출판 편집자 수준의 문서 편집 가이드

## 🎯 개요

`edit_full_documents_v2.py`는 20년 경력 출판 편집자의 사고 프로세스를 구현한 2-Pass 편집 시스템입니다.

### 편집 철학

1. **독자가 막힘 없이 읽을 수 있어야 합니다**
2. **저자의 의도와 톤을 절대 훼손하지 않습니다**
3. **불필요한 수식어와 중복을 과감히 제거합니다**
4. **한 문장 = 하나의 핵심 아이디어**
5. **소리 내어 읽었을 때 자연스러워야 합니다**

---

## 🚀 사용법

### 기본 사용

```bash
# 전체 2-Pass 편집 (교정 + 윤문)
python edit_full_documents_v2.py output/output_laf_translated.md
```

### 옵션

```bash
# Pass 1만 실행 (교정만, 윤문 생략)
python edit_full_documents_v2.py output/output_laf_translated.md --pass1-only

# 병렬 처리 워커 수 조정 (기본: 10)
python edit_full_documents_v2.py output/output_laf_translated.md --workers 5

# 비교 리포트 생성 안 함
python edit_full_documents_v2.py output/output_laf_translated.md --no-diff
```

---

## 📁 출력 구조

```
output_edited/
└── output_laf_translated/
    ├── output_laf_translated_edited.md      # 최종 편집본
    ├── output_laf_translated_pass1.md       # Pass 1 결과 (참고용)
    └── output_laf_translated_diff_report.md # 변경사항 비교
```

### 파일 설명

| 파일 | 설명 |
|------|------|
| `*_edited.md` | **최종 편집본** - 출판 가능한 수준의 완성본 |
| `*_pass1.md` | Pass 1 (교정) 결과 - 맞춤법/띄어쓰기만 수정 |
| `*_diff_report.md` | 원문과 편집본의 변경사항 비교 |

---

## 🔄 2-Pass 편집 시스템

### Pass 1: 기계적 교정 (Proofreading)

**목적**: 맞춤법, 띄어쓰기, 문장부호만 수정

**수정 항목**:
- ❌ `~되어지다` → ✅ `~된다`
- ❌ `~되어진다` → ✅ `~된다`
- ❌ `것이다` (남용) → ✅ 제거 또는 자연스럽게
- ❌ `~에 의해` → ✅ `~로/~가`
- 띄어쓰기 오류 수정
- 문장부호 정리

**특징**:
- 문장 구조는 변경하지 않음
- 의미 변경 금지
- 낮은 temperature (0.2)로 일관성 확보

### Pass 2: 창의적 윤문 (Polishing)

**목적**: 문장 구조, 가독성, 리듬감 개선

**개선 항목**:

1. **번역체 제거**
   ```
   ❌ "그것은...때였습니다"
   ✅ "그때...했습니다"
   ```

2. **긴 문장 분리**
   ```
   ❌ 50단어 이상의 긴 문장
   ✅ 2-3개 문장으로 분리
   ```

3. **수동태 → 능동태**
   ```
   ❌ "유혹되고"
   ✅ "혹했고"
   ```

4. **중복 제거**
   ```
   ❌ "의도적으로...선택했다"
   ✅ "선택했다"
   ```

5. **리듬감 추가**
   - 짧은 문장과 긴 문장 교차
   - 강조할 부분은 짧게

**특징**:
- 의미는 절대 변경하지 않음
- 톤 유지 (존댓말 → 존댓말)
- 약간 높은 temperature (0.5)로 창의성 확보

---

## 📊 편집 예시

### 예시 1: 번역체 제거

```markdown
❌ 원문:
"그것은 우리가 피벗을 해야만 했다는 것을 제가 깨달았을 때였습니다."

✅ 편집:
"그때 깨달았습니다. 방향을 바꿔야 한다는 것을요."

개선점:
- "그것은...때였습니다" 번역체 제거
- 2개 문장으로 분리
- 리듬감 추가
```

### 예시 2: 긴 문장 분리

```markdown
❌ 원문:
"저는 25세였고, 그의 도착으로 인해 방향 감각을 잃었으며, 
그의 외모와 어조에 위협을 느꼈고, 완전히 공황 상태였습니다."

✅ 편집:
"저는 25세였습니다. 그가 나타났을 때 당황했습니다. 
그의 외모와 어조가 위협적이었고, 완전히 공황 상태에 빠졌습니다."

개선점:
- 50단어 문장을 3개로 분리
- 각 문장이 하나의 아이디어
- 자연스러운 호흡
```

### 예시 3: 수동태 → 능동태

```markdown
❌ 원문:
"이러한 제안에 유혹되고 세 사람의 급여와 임차료를 충당하기 위해 
현금이 절실했던 저희는 무분별하게 빌렸고, 결국 큰 빚을 지게 되었습니다."

✅ 편집:
"우리는 이런 제안에 혹했습니다. 세 사람의 급여와 임차료를 내야 했으니까요. 
무분별하게 빌렸고, 결국 큰 빚을 졌습니다."

개선점:
- 수동태 → 능동태
- 3개 문장으로 분리
- 인과관계 명확화
```

---

## 💰 비용 및 성능

### 예상 비용 (Claude 3.7 Sonnet 기준)

| 문서 크기 | 예상 비용 | 처리 시간 |
|----------|----------|----------|
| 1,000자 | ~$0.05 | ~10초 |
| 10,000자 | ~$0.50 | ~1분 |
| 50,000자 | ~$2.50 | ~5분 |

**비용 절감 팁**:
- `--pass1-only` 옵션으로 교정만 실행 (비용 50% 절감)
- `--workers` 수를 줄여 API 호출 분산

### 성능 최적화

- **병렬 처리**: 기본 10개 워커로 빠른 처리
- **청크 분할**: Section 단위로 분할하여 맥락 유지
- **스마트 재결합**: 청크 순서 보장

---

## 🔍 품질 검증

### 자동 검증 항목

1. **맞춤법/띄어쓰기** (Pass 1)
2. **번역체 표현** (Pass 2)
3. **문장 길이** (Pass 2)
4. **수동태 사용** (Pass 2)
5. **중복 표현** (Pass 2)

### 수동 검증 권장

편집 후 다음을 확인하세요:

- [ ] 소리 내어 읽었을 때 자연스러운가?
- [ ] 저자의 의도가 보존되었는가?
- [ ] 톤이 일관되는가?
- [ ] 전문 용어가 정확한가?

---

## 🛠️ 문제 해결

### API 오류

```bash
⚠️  Claude API 호출 실패: Error code: 404
```

**해결**: 모델 이름 확인
- 현재 사용: `claude-3-7-sonnet-20250219`
- `.env` 파일에 `ANTHROPIC_API_KEY` 설정 확인

### 메모리 부족

```bash
MemoryError: Unable to allocate array
```

**해결**: 워커 수 줄이기
```bash
python edit_full_documents_v2.py file.md --workers 3
```

### 느린 처리 속도

**해결**: 워커 수 늘리기 (단, API 레이트 한계 주의)
```bash
python edit_full_documents_v2.py file.md --workers 15
```

---

## 📚 추가 자료

### 관련 파일

- `src/editing/prompts/editor_persona.py` - 편집자 페르소나
- `src/editing/prompts/proofreading_prompt.py` - Pass 1 프롬프트
- `src/editing/prompts/polishing_prompt.py` - Pass 2 프롬프트
- `src/editing/utils/diff_generator.py` - 변경사항 비교 도구

### 참고 문서

- `TRANSLATION_GUIDELINE.md` - 번역 가이드라인
- `HOW_TO_RETRANSLATE.md` - 재번역 가이드

---

## 🎓 편집 철학 상세

### 출판 편집의 3단계

1. **교정 (Proofreading)**: 맞춤법, 띄어쓰기, 문장부호
2. **교열 (Copy Editing)**: 문장 구조, 논리, 일관성
3. **윤문 (Line Editing)**: 가독성, 리듬감, 스타일

이 시스템은 1단계(교정)와 3단계(윤문)를 자동화합니다.
2단계(교열)는 사실 확인 등 사람의 판단이 필요한 영역입니다.

### 편집 vs 번역

| 구분 | 번역 | 편집 |
|------|------|------|
| 목적 | 의미 전달 | 가독성 향상 |
| 대상 | 외국어 → 한국어 | 한국어 → 더 나은 한국어 |
| 자유도 | 낮음 (원문 충실) | 중간 (의미 보존) |
| 창의성 | 제한적 | 허용 |

---

## 💡 팁

### 최상의 결과를 위한 팁

1. **원본 품질이 중요합니다**
   - 번역본이 이미 좋으면 편집 효과 극대화
   - 번역본이 나쁘면 편집으로 한계 있음

2. **Pass 1 결과 확인**
   - `*_pass1.md` 파일로 교정 결과 확인
   - 문제가 있으면 Pass 2 전에 수정

3. **비교 리포트 활용**
   - `*_diff_report.md`로 변경사항 검토
   - 과도한 변경이 있으면 원본 복원

4. **도메인별 커스터마이징**
   - 비즈니스서: 현재 설정 최적
   - 소설: temperature 높이기 (0.7)
   - 기술서: temperature 낮추기 (0.3)

---

**버전**: 2.0  
**최종 업데이트**: 2025-11-19  
**작성자**: Kiro AI Assistant
